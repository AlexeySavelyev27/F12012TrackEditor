<Window x:Class="PSSGEditor.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:local="clr-namespace:PSSGEditor"
        Title="PromixFlame PSSG Editor" Height="600" Width="900">
    <Window.Resources>
        <local:SubtractConverter x:Key="SubtractConverter" />
    </Window.Resources>
    <DockPanel>
        <!-- Menu с нижним разделителем -->
        <Border DockPanel.Dock="Top" BorderBrush="Black" BorderThickness="0,0,0,1">
            <Menu>
                <MenuItem Header="_File">
                    <MenuItem x:Name="OpenMenuItem" Header="_Open" Click="OpenMenuItem_Click"/>
                    <MenuItem x:Name="SaveAsMenuItem" Header="Save _As" Click="SaveAsMenuItem_Click"/>
                    <Separator/>
                    <MenuItem Header="E_xit" Click="ExitMenuItem_Click"/>
                </MenuItem>
            </Menu>
        </Border>

        <!-- Строка статуса с верхним разделителем -->
        <Border DockPanel.Dock="Bottom" BorderBrush="Black" BorderThickness="0,1,0,0">
            <StatusBar x:Name="MainStatusBar">
                <StatusBarItem>
                    <TextBlock x:Name="StatusText" Text="Ready" />
                </StatusBarItem>
            </StatusBar>
        </Border>

        <!-- Основная область: две панели без каких-либо внешних рамок -->
        <Grid>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="2*" />
                <ColumnDefinition Width="5" />
                <ColumnDefinition Width="5*" />
            </Grid.ColumnDefinitions>

            <!-- Левый TreeView без обводки -->
            <TreeView Grid.Column="0"
                      x:Name="PssgTreeView"
                      SelectedItemChanged="PssgTreeView_SelectedItemChanged"
                      Background="White"
                      BorderThickness="0"
                      BorderBrush="Transparent"
                      Padding="2" />

            <!-- Вертикальный сплиттер -->
            <GridSplitter Grid.Column="1"
                          HorizontalAlignment="Stretch"
                          VerticalAlignment="Stretch"
                          Width="5"
                          Background="LightGray"
                          ShowsPreview="True" />

            <!-- Правая панель -->
            <Grid Grid.Column="2"
                  x:Name="RightPanel"
                  PreviewMouseLeftButtonDown="RightPanel_PreviewMouseLeftButtonDown">
                <!-- DataGrid без обводки -->
                <DataGrid x:Name="AttributesDataGrid"
                      AutoGenerateColumns="False"
                      CanUserAddRows="False"
                      IsReadOnly="False"
                      HeadersVisibility="Column"
                      RowHeaderWidth="0"
                      SelectionUnit="Cell"
                      PreviewMouseLeftButtonDown="AttributesDataGrid_PreviewMouseLeftButtonDown"
                      PreviewKeyDown="AttributesDataGrid_PreviewKeyDown"
                      PreparingCellForEdit="AttributesDataGrid_PreparingCellForEdit"
                      Sorting="AttributesDataGrid_Sorting"
                      Background="Gray"
                      BorderThickness="0"
                      BorderBrush="Transparent"
                      FocusVisualStyle="{x:Null}">
                <!-- Limit row height so the cell content doesn't overlap the status bar -->
                <DataGrid.RowStyle>
                    <Style TargetType="DataGridRow">
                        <Setter Property="Height" Value="Auto" />
                        <Setter Property="MaxHeight">
                            <Setter.Value>
                                <MultiBinding Converter="{StaticResource SubtractConverter}">
                                    <Binding ElementName="RightPanel" Path="ActualHeight" />
                                    <Binding ElementName="MainStatusBar" Path="ActualHeight" />
                                </MultiBinding>
                            </Setter.Value>
                        </Setter>
                    </Style>
                </DataGrid.RowStyle>
                <DataGrid.Resources>
                    <Style TargetType="DataGridCell">
                        <Setter Property="FocusVisualStyle" Value="{x:Null}" />
                        <Setter Property="BorderThickness" Value="0" />
                    </Style>
                </DataGrid.Resources>
                <DataGrid.Columns>
                    <!-- Столбец «Attribute» с серым фоном и синим выделением -->
                    <DataGridTextColumn Header="Attribute"
                                        Binding="{Binding Key}"
                                        SortMemberPath="Key"
                                        IsReadOnly="True"
                                        Width="Auto">
                        <DataGridTextColumn.CellStyle>
                            <Style TargetType="DataGridCell" BasedOn="{StaticResource {x:Type DataGridCell}}">
                                <Setter Property="Background" Value="#EEEEEE" />
                                <Style.Triggers>
                                    <Trigger Property="IsSelected" Value="True">
                                        <Setter Property="Background"
                                                Value="{DynamicResource {x:Static SystemColors.HighlightBrushKey}}" />
                                        <Setter Property="Foreground"
                                                Value="{DynamicResource {x:Static SystemColors.HighlightTextBrushKey}}" />
                                    </Trigger>
                                </Style.Triggers>
                            </Style>
                        </DataGridTextColumn.CellStyle>
                    </DataGridTextColumn>
                    <!-- Столбец «Value» с переносом строк и прокруткой -->
                    <DataGridTemplateColumn Header="Value"
                                            SortMemberPath="Value"
                                            Width="*">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <ScrollViewer VerticalScrollBarVisibility="Auto"
                                              Focusable="False"
                                              MouseLeftButtonDown="ValueScrollViewer_MouseLeftButtonDown">
                                    <ScrollViewer.MaxHeight>
                                        <MultiBinding Converter="{StaticResource SubtractConverter}">
                                            <Binding ElementName="RightPanel" Path="ActualHeight" />
                                            <Binding ElementName="MainStatusBar" Path="ActualHeight" />
                                        </MultiBinding>
                                    </ScrollViewer.MaxHeight>
                                    <TextBlock Text="{Binding Value}"
                                               TextWrapping="Wrap"/>
                                </ScrollViewer>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                        <DataGridTemplateColumn.CellEditingTemplate>
                            <DataTemplate>
                                <ScrollViewer VerticalScrollBarVisibility="Auto"
                                              Focusable="False"
                                              MouseLeftButtonDown="ValueScrollViewer_MouseLeftButtonDown">
                                    <ScrollViewer.MaxHeight>
                                        <MultiBinding Converter="{StaticResource SubtractConverter}">
                                            <Binding ElementName="RightPanel" Path="ActualHeight" />
                                            <Binding ElementName="MainStatusBar" Path="ActualHeight" />
                                        </MultiBinding>
                                    </ScrollViewer.MaxHeight>
                                    <TextBox Text="{Binding Value}"
                                             AcceptsReturn="True"
                                             TextWrapping="Wrap"/>
                                </ScrollViewer>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellEditingTemplate>
                    </DataGridTemplateColumn>
                </DataGrid.Columns>
                <DataGrid.CellStyle>
                    <Style TargetType="DataGridCell">
                        <EventSetter Event="MouseDoubleClick"
                                     Handler="AttributesDataGrid_CellMouseDoubleClick" />
                    </Style>
                </DataGrid.CellStyle>
                </DataGrid>
            </Grid>
        </Grid>
    </DockPanel>
</Window>
